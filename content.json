[{"title":"el-tree根据条件异步加载并默认展开","date":"2023-10-26T06:40:24.000Z","path":"2023/10/26/el-tree根据条件异步加载并默认展开/","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105&lt;template&gt; &lt;div class=&quot;hello&quot;&gt; &lt;el-tree :data=&quot;list&quot; :lazy=&quot;lazy&quot; :default-expanded-keys=&quot;defaultKeys&quot; :load=&quot;loadfn&quot; :props=&quot;defaultProps&quot; node-key=&quot;id&quot; @node-click=&quot;handleNodeClick&quot; &gt;&lt;/el-tree&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt; export default &#123; data() &#123; return &#123; lazy: true, // 模拟最初初始化数据 data: [&#123; id: 1, label: &#x27;一级 1&#x27;, children: [] &#125;, &#123; id: 2, label: &#x27;一级 2&#x27;, children: [] &#125;, &#123; id: 3, label: &#x27;一级 3&#x27;, children: [] &#125;], list: [], /* 默认展开项。其中的id必须是现有数据中包含的id。 比如，最初请求接口返回的数据项中含有id为1的数据，而请求id为1的接口后返回的数据中又有一项id是9的数据。 总之数组中的id，必须是上一个id请求数据后返回的数据中有这个id。 */ defaultKeys: [1, 9], defaultProps: &#123; children: &#x27;children&#x27;, label: &#x27;label&#x27; &#125; &#125;; &#125;, mounted() &#123; &#125;, methods: &#123; handleNodeClick(data) &#123; &#125;, loadfn(e, resolve) &#123; // 传入id console.log(e.data.id); // 最开始外层逻辑，此处用的e.id,因为初始没有数据 if(e.id == 0) &#123; resolve(this.data) &#125; // id是模拟接口请求不同的id if(e.data.id == 1) &#123; resolve([&#123; id: 9, label: &#x27;三级 1-1-1&#x27;, children: [] &#125;]) &#125; if(e.data.id == 9) &#123; resolve( [&#123; id: 10, label: &#x27;三级 1-1-2&#x27;, children: [] &#125;] ) &#125; &#125; &#125; &#125;;&lt;/script&gt;&lt;!-- Add &quot;scoped&quot; attribute to limit CSS to this component only --&gt;&lt;style scoped&gt;h3 &#123; margin: 40px 0 0;&#125;ul &#123; list-style-type: none; padding: 0;&#125;li &#123; display: inline-block; margin: 0 10px;&#125;a &#123; color: #42b983;&#125;&lt;/style&gt;","tags":[{"name":"vue","slug":"vue","permalink":"https://smiles73.github.io/tags/vue/"},{"name":"vue2","slug":"vue2","permalink":"https://smiles73.github.io/tags/vue2/"},{"name":"树结构","slug":"树结构","permalink":"https://smiles73.github.io/tags/%E6%A0%91%E7%BB%93%E6%9E%84/"},{"name":"elementui","slug":"elementui","permalink":"https://smiles73.github.io/tags/elementui/"}]},{"title":"vue会议时间选择插件","date":"2023-10-24T07:22:09.000Z","path":"2023/10/24/vue会议时间选择插件/","text":"123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169&lt;template&gt; &lt;div class=&quot;range-time-box&quot;&gt; &lt;span :class=&quot;&#123;active:item.checked, reservation: item.status == 1, inUse: item.status == 2&#125;&quot; v-for=&quot;(item,index) in range&quot; :key=&quot;index&quot; @click=&quot;timeRangeChange(item, index)&quot;&gt;&#123;&#123;item.time&#125;&#125;&lt;/span&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123; // 传入的值 model: &#123; // 表明v-model.trim传进来的变量，由props的指定变量接收 prop: &quot;checkList&quot;, event: &quot;input&quot;, &#125;, // 接收的值 props: &#123; checkList: &#123; type: Array, default: () =&gt; [], &#125;, /** * 会议室时间段 * id: 时间段id * status: 0 未预约 1 已预约 2 正在使用 * checked: 是否选中 * time: 时间段 */ timeRange: &#123; type: Array, default: () =&gt; [], &#125;, &#125;, watch: &#123; // 监听外部v-model.trim传进来的，填入到data中的range，防止数据异步从而获取不到的问题 timeRange: &#123; handler() &#123; this.range = this.timeRange; &#125;, immediate: true, deep: true, &#125;, &#125;, data() &#123; return &#123; range: [], // 正在使用 useList: this.timeRange.filter( (item) =&gt; item.status == 2 || item.status == 1 ), // 当前选择项 checkedIndex: [], // 渲染数组 renderingArr: [], &#125;; &#125;, methods: &#123; timeRangeChange(item, index) &#123; // 已预约或正在使用不可选 if (item.status == 1 || item.status == 2) return; // 更改选择 item.checked = !item.checked; // 取消选择 if (!item.checked) &#123; this.checkedIndex = this.checkedIndex.filter((item) =&gt; item !== index); return; &#125; // 清空已选项 if (this.renderingArr.length &gt; 0) &#123; this.reset(); // 选中当前项 item.checked = true; &#125; // 选择时间段开始时间 if (this.checkedIndex.length == 0) &#123; this.checkedIndex.push(index); &#125; else if (this.checkedIndex[0].id != item.id) &#123; // 选择时间段结束时间 this.checkedIndex.push(index); // 渲染数组 this.renderingArr = this.generate(this.checkedIndex); try &#123; // 判断是否包含已预约或正在使用 this.renderingArr.forEach((idx) =&gt; &#123; // 已预约或正在使用不可选 let status = this.range[idx].status; if (status != 0) &#123; throw new Error(status == 1 ? &quot;当前包含已预定时段&quot;:&#x27;当前包含已使用时段&#x27;) &#125; &#125;); &#125; catch (e) &#123; this.$message.warning(e.message); this.checkedIndex.pop(); this.renderingArr = []; item.checked = false return; &#125; // 渲染选择项 let checkedArr = [] this.renderingArr.forEach((idx) =&gt; &#123; this.range[idx].checked = true; checkedArr.push(this.range[idx]) &#125;); this.$emit(&quot;input&quot;, checkedArr); // 暴露出v-model.trim this.$emit(&quot;rangeChange&quot;, checkedArr, this.renderingArr); // 暴露出rangeChange &#125; &#125;, // 重置 reset() &#123; this.range.forEach((item) =&gt; &#123; item.checked = false; &#125;); this.checkedIndex = []; this.renderingArr = []; &#125;, // 生成渲染数组 generate(array) &#123; let start = Math.min.apply(Math, array), end = Math.max.apply(Math, array); var _self = this; var length = end - start + 1; var step = start - 1; return Array.apply(null, &#123; length: length &#125;).map(function (v, i) &#123; step++; return step; &#125;); &#125;, &#125;,&#125;;&lt;/script&gt;&lt;style scoped lang=&quot;scss&quot;&gt;.range-time-box &#123; margin-top: 10px; width: 100%; display: flex; flex-wrap: wrap; span &#123; display: inline-block; width: 64px; height: 32px; line-height: 32px; text-align: center; font-size: 14px; background-color: #67c23a; color: #fff; border-bottom: 1px solid #efefef; border-right: 1px solid #efefef; cursor: pointer; &amp;.active &#123; background-color: #409eff; &#125; &amp;.reservation &#123; background-color: #ffb640; &#125; &amp;.inUse &#123; background-color: rgb(255, 64, 64); &#125; &#125;&#125;&lt;/style&gt;","tags":[{"name":"vue2","slug":"vue2","permalink":"https://smiles73.github.io/tags/vue2/"},{"name":"组件","slug":"组件","permalink":"https://smiles73.github.io/tags/%E7%BB%84%E4%BB%B6/"}]}]